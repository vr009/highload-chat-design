# highload_chat_design

1. Тип сервиса, функционал MVP и целевая аудитория
Тип сервиса: мессенджер
MVP:
- отправка сообщений
- список чатов
- каналы
- группы
- диалоги
- история сообщений
- регистрация по номеру телефона

Целевая аудитория:
- РФ и страны СНГ (10 мин в день)
- Европа
- Северная и Южная Америка

2. Расчет нагрузки
    ###Продуктовые метрики
 - Месячная аудитория: 500 млн активных пользователей
 - Дневная аудитория: 350млн со всего мира, 40 млн активных пользователей из России
 - Средний размер хранилища пользователя:
    * Данные о пользователе (номер телефона, никнейм, дата регистрации, последняя активность, аватар (в ср. 1-2 фотографии)) - 11Б + 10Б + 20КБ + 20КБ = 40кБ
    * Сообщения пользователя (40 сообщений в день 35 текстовых + 3 голосовых + 2 медиа) = (35 * 50Б) + (3*160кБ(1мин)) + (2*250кБ) = 880+1750 = 3630кБ
    * Сообщения пользователя будем хранить всегда (5 лет) - 3630 * 182*10 = 6гБ
    * Список чатов, групп и каналов пользователя [(Название элемента) 15Б + (последнее сообщение) 20Б + (время) 5Б] * 20 = 800Б = 8кБ
    * Всего на одного пользователя: 48кБ + 8кБ + 662мБ = 6гБ
   - Среднее количество действий пользователя по типам в день (типы запросов выбираем на основании выбраного функционала MVP) Оформить в виде сводной таблицы

     Действие               | Среднее кол-во в день
     -----------------------| -------------
     Отправка сообщения     | 20
     Получение сообщения    | 40
     Пост в канале          | 1

     Действие             | Среднее кол-во в месяц
     -------------------- | ----------------------
     Создание чата        | 1
     Добавление в чат     | 2
   
   ###Технические метрики
 - Размер хранения в разбивке по типам данных (в Тб) - для существенных блоков данных
    На одного пользователя за 5 лет требуется хранить 6ГБ, соответственно на 500 млн пользователей:
    6ГБ * 500млн = 300 000 ТБ
 - Сетевой трафик
    Основная нагрузка приходится на сообщения, рассмотрим трафик по типам сообщений

    Тип          | Отправка (дневаня аудитория 300 млн) | Отправка Тб/сутки | Получение (из-за какналов и групповых чатов возьмем доп. эмпирич. коэф.) Тб/сутки 
   ------------- |--------------------------------------|-------------------|-----------------------------------------------------------------------------------|
   Текстовое     | 35 * 300млн * 0.05кБ                 | 0.52              | 0.52 * 8 = 4.16                                                                   |
   Голосовое     | 3 * 300млн * 160кБ                   | 134               | 134 * 3 = 402                                                                     |
   Файл          | 2 * 300млн * 250кБ                   | 139               | 139 * 5 = 695                                                                     |

 RPS в разбивке по типам запросов (запросов в секунду) - для основных запросов Оформить в виде сводной таблицы.

   Действие                            | RPS
   ------------------------------------| -------------
   Отправка сообщения                  | 20
   Получение сообщения                 | 40
   Пост в канале                       | 1
   Добавление в групповой чат          | 1

3. Логическая схема
4. Физическая схема
5. Технологии
6. Схема проекта
7. Список серверов